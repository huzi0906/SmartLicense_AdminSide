@model SmartLicense_AdminSide.Models.User

@{
    ViewData["Title"] = "Test";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Test</h2>

@if (Model != null)
{
    <div class="card">
        <h3>Candidate Details</h3>
        <div class="candidate-info">
            <div>
                <strong>CNIC:</strong> @Model.CNIC
            </div>
            <div>
                <strong>Name:</strong> @Model.Name
            </div>
            <div>
                <strong>Age:</strong> @Model.Age
            </div>
            <div>
                <strong>Driving Test:</strong> @(Model.HasLicence ? "Passed" : (Model.HasLearnerLicence ? "In Progress" : "Not Started"))
            </div>
        </div>
    </div>

    <div class="card">
        <h3>Test Control</h3>
        <div class="test-controls">
            <div id="statusMessage" style="color: #333; margin-bottom: 10px;"></div>
            @if (!Model.HasLicence)
            {
                <button id="startButton" class="btn start" onclick="startTest()">Start</button>
                <button id="stopButton" class="btn stop" onclick="stopTest()">Stop</button>
            }
        </div>
        @if (Model.HasLicence)
        {
            <button class="btn report">View Test Report</button>
        }
    </div>
}
else
{
    <div class="alert alert-warning">User not found</div>
}

@section Scripts {
    <script>
        function startTest() {
            console.log("Sending POST request to http://localhost:5000/start");
            document.getElementById('statusMessage').innerText = "Starting test...";
            fetch('http://localhost:5000/start', {
                method: 'POST',
            })
            .then(response => response.text())
            .then(data => {
                console.log("Response from start:", data);
                document.getElementById('statusMessage').innerText = "Test started successfully";
                document.getElementById('startButton').disabled = true;
                document.getElementById('stopButton').disabled = false;
            })
            .catch(error => {
                console.error("Error starting test:", error);
                document.getElementById('statusMessage').innerText = "Error starting test";
            });
        }

        function stopTest() {
            console.log("Sending POST request to http://localhost:5000/stop");
            document.getElementById('statusMessage').innerText = "Stopping test...";
            fetch('http://localhost:5000/stop', {
                method: 'POST',
            })
            .then(response => response.text())
            .then(data => {
                console.log("Response from stop:", data);
                document.getElementById('statusMessage').innerText = "Test stopped successfully";
                document.getElementById('stopButton').disabled = true;
                document.getElementById('startButton').disabled = false;
            })
            .catch(error => {
                console.error("Error stopping test:", error);
                document.getElementById('statusMessage').innerText = "Error stopping test";
            });
        }
    </script>
}